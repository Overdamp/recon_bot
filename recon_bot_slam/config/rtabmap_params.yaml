rtabmap:
  ros__parameters:
    # General
    use_sim_time: false
    frame_id: base_footprint
    odom_frame_id: odom
    map_frame_id: map
    world_frame_id: world

    # Input
    subscribe_rgb: true
    subscribe_depth: true
    rgb_topic: /zed/zed_node/rgb/image_rect_color
    depth_topic: /zed/zed_node/depth/depth_registered
    camera_info_topic: /zed/zed_node/rgb/camera_info
    odom_topic: /odom
    scan_topic: /scan_merged  # Optional: fuse LiDAR

    # Sync
    approx_sync: true  # Approximate time sync (ถ้า timestamp ไม่ตรง)

    # Visual Odometry
    visual_odometry: true  # เปิด VIO (ใช้ ZED odom)

    # Map
    grid_map: true  # สำคัญ: สร้าง 2D projection
    grid_from_depth: true  # ใช้ depth สำหรับ 2D grid
    proj_map_max_height: 0.5  # กรอง z > 0.5 m (ceiling)
    proj_map_min_height: -0.2  # กรอง z < -0.2 m (ground)

    # Features (ลด "not found word")
    RGBD/NeighborLinkRefining: true
    RGBD/ProximityBySpace: true
    RGBD/LoopFromConstraint: false
    RGBD/AngularUpdate: 0.01  # rad (เพิ่ม accuracy)
    RGBD/LinearUpdate: 0.01  # m
    RGBD/ORBnFeatures: 500  # ลดจาก 1000 → features น้อย, ลด error
    RGBD/SURF/HessianThreshold: 100  # ลด detect textured area
    RGBD/OptimizeFromGraphEnd: false
    RGBD/OptimizeMaxError: 1.0  # m (ลด error threshold)

    # Database
    database_path: ~/rtabmap.db
    Mem/IncrementalMemory: true  # SLAM mode
    Mem/InitWMWithAllNodes: false  # ลด memory

    # TF
    publish_tf: true
    publish_tf_map_scanmatch: true  # TF ผ่าน scan matching

    # Output
    publish_odom: true
    publish_odom_combined: true  # Fuse odom + VIO